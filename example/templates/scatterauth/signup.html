{% extends 'scatterauth/base.html' %}
{% block content %}
  <div class="row m-t-2">
    <form action="" method="POST">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">Sign Up</button>
    </form>
  </div>
{% endblock content %}
{% block javascript %}
  {{ block.super }}
  <script>

    // Custom network example
    /*
    const CHAIN_ID = '038f4b0fc8ff18a4f0842a8f0564611f6e96e8535901dd45e43ac8691a1c4dca';
    const CHAIN_PROTOCOL = 'http';
    const CHAIN_HOST = '193.93.219.219';
    const CHAIN_PORT = 8888;

    const NETWORK = {
      protocol: CHAIN_PROTOCOL,
      blockchain: 'eos',
      host: CHAIN_HOST,
      port: CHAIN_PORT,
      chainId: CHAIN_ID
    };
    */
    var signup = '{% url 'scatterauth_signup_api' %}';
    var fields = ['email'];
    var public_key_field_name = 'username';

    window.ScatterJS.scatter.connect("LRB").then(connected => {
      if (!connected) return console.log('Failed to connect with Scatter!');
      var scatter = window.ScatterJS.scatter;
      var requiredFields = {
      accounts: [network]
      }
      scatter.getIdentity(requiredFields).then(identity => {
        if (identity) {
          // login the user with api
          console.log("Identity found");
          console.log(identity);
          console.log("Welcome, " + identity.name ? identity.name : "Anonymous"
                      + '<br>Your public key: ' + identity.publicKey);
        } else {
          requestIdentity(fields, public_key_field_name, signup, null, console.log);
        }
      });
    });
  </script>
{% endblock javascript %}
